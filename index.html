<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CYBER DASH - CLUB EDITION</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; touch-action: none; }
        body { background: #000; color: #fff; font-family: 'Orbitron', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        #left-col, #right-col { width: 280px; border: 2px solid #ffffff22; background: rgba(5,5,20,0.98); margin: 10px; border-radius: 15px; display: flex; flex-direction: column; }
        #game-col { flex-grow: 1; display: flex; justify-content: center; align-items: center; flex-direction: column; position: relative; }
        .panel-title { padding: 15px; text-align: center; font-weight: 900; border-bottom: 1px solid #ffffff22; color: #00f2ff; letter-spacing: 2px; }
        #container { height: 85vh; aspect-ratio: 9/16; position: relative; border: 3px solid #fff; background: #000; overflow: hidden; }
        canvas { width: 100%; height: 100%; }
        
        /* CHAT COMMAND */
        #cmd-bar { width: 100%; max-width: 400px; margin-top: 10px; display: flex; gap: 5px; }
        #cmd-input { flex-grow: 1; background: #111; border: 2px solid #00f2ff; color: #fff; padding: 10px; font-family: 'Orbitron'; border-radius: 5px; }
        
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.9); z-index: 100; text-align: center; padding: 20px; }
        .active-screen { display: flex !important; }
        .btn-ui { border: 2px solid #fff; padding: 12px 25px; color: #fff; cursor: pointer; font-weight: 900; margin-top: 15px; width: 85%; }
        #paypal-box { background: #ffc439; color: #003087; font-weight: 900; padding: 12px; border-radius: 5px; margin: 10px; cursor: pointer; text-align: center; }
        .scroll-zone { flex-grow: 1; overflow-y: auto; padding: 10px; }
        .item-list { background: rgba(255,255,255,0.05); margin-bottom: 8px; padding: 10px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; font-size: 11px; }
        .buy-btn { background: #00f2ff; color: #000; border: none; padding: 5px 10px; border-radius: 4px; font-weight: 900; cursor: pointer; }
    </style>
</head>
<body>

    <div id="left-col">
        <div class="panel-title">LEADERBOARD</div>
        <div id="leaderboard" class="scroll-zone"></div>
    </div>

    <div id="game-col">
        <div id="container">
            <div id="screen-login" class="screen active-screen">
                <h1>CYBER DASH</h1>
                <input type="text" id="nick" placeholder="PSEUDO..." style="margin:20px; padding:12px; background:none; border:2px solid #fff; color:#fff; text-align:center;">
                <div class="btn-ui" onclick="init()">JOUER</div>
            </div>
            <div id="screen-hub" class="screen">
                <div id="hub-stats" style="color:#00f2ff; margin-bottom:10px;"></div>
                <div class="btn-ui" onclick="start('INF')">MODE INFINI</div>
            </div>
            <canvas id="cvs"></canvas>
        </div>
        
        <div id="cmd-bar">
            <input type="text" id="cmd-input" placeholder="TAPE /PSG, /OM, /REAL..." onkeydown="if(event.key==='Enter') execCmd()">
        </div>
    </div>

    <div id="right-col">
        <div class="panel-title">BOUTIQUE</div>
        <div id="shop" class="scroll-zone"></div>
        <div id="paypal-box" onclick="window.open('https://paypal.me/frsaamya/2.99')">PAYPAL: +5000 ðŸª™</div>
        <div id="user-coins" style="text-align:center; color:#ffd700; font-weight:900; padding:15px; font-size:24px;">0 ðŸª™</div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDoNMSFtT2i8Eqt_G3UwR92AxbtHhumDF0", authDomain: "cyberdash-2baf5.firebaseapp.com", databaseURL: "https://cyberdash-2baf5-default-rtdb.europe-west1.firebasedatabase.app", projectId: "cyberdash-2baf5", storageBucket: "cyberdash-2baf5.firebasestorage.app", messagingSenderId: "360233647601", appId: "1:360233647601:web:60aa25f439019ed7511850" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const cvs = document.getElementById("cvs"); const ctx = cvs.getContext("2d"); cvs.width = 600; cvs.height = 1000;
    let user="", ip="", coins=0, record=0, state="LOGIN", score=0, ballX=300, ballY=750, obs=[], keys={};
    let ballColor="#fff", currentAcc="none", logoImg = new Image();
    let useLogo = false;

    const clubLogos = {
        "/psg": "https://upload.wikimedia.org/wikipedia/fr/thumb/8/86/Paris_Saint-Germain_Logo.svg/1024px-Paris_Saint-Germain_Logo.svg.png",
        "/om": "https://upload.wikimedia.org/wikipedia/fr/thumb/4/43/Olympique_de_Marseille_logo.svg/1024px-Olympique_de_Marseille_logo.svg.png",
        "/real": "https://upload.wikimedia.org/wikipedia/fr/thumb/c/c7/Logo_Real_Madrid.svg/1024px-Logo_Real_Madrid.svg.png",
        "/barca": "https://upload.wikimedia.org/wikipedia/fr/thumb/a/a1/Logo_FC_Barcelone.svg/1024px-Logo_FC_Barcelone.svg.png"
    };

    function execCmd() {
        let val = document.getElementById('cmd-input').value.toLowerCase();
        if(clubLogos[val]) {
            logoImg.src = clubLogos[val];
            useLogo = true;
            document.getElementById('cmd-input').value = "";
            alert("BALLON " + val.toUpperCase() + " ACTIVÃ‰ !");
        } else if(val === "/reset") {
            useLogo = false;
        }
    }

    function sync() { db.ref('users/'+ip).update({coins, record, user, ballColor, currentAcc}); }

    function init() {
        user = document.getElementById('nick').value.toUpperCase() || "PLAYER";
        document.getElementById('screen-login').classList.remove('active-screen');
        document.getElementById('screen-hub').classList.add('active-screen');
        fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>{
            ip = d.ip.replace(/\./g, '_');
            db.ref('users/'+ip).on('value', s=>{
                const v = s.val()||{}; coins=v.coins||0; record=v.record||0;
                document.getElementById('user-coins').innerText = `${coins} ðŸª™`;
                document.getElementById('hub-stats').innerText = `BEST: ${record}`;
                renderShop();
            });
        });
        db.ref('users').orderByChild('record').limitToLast(10).on('value', s=>{
            let h=""; s.forEach(x=>{ let p=x.val(); h=`<div class="item-list"><span>${p.user}</span><b>${p.record}</b></div>`+h; });
            document.getElementById('leaderboard').innerHTML=h;
        });
    }

    function renderShop() {
        const accs = [{id:"acc_glasses", n:"LUNETTES", p:300}, {id:"acc_crown", n:"COURONNE", p:1000}];
        let h = `<div style="font-size:10px; color:#aaa; margin-bottom:10px;">ACCESSOIRES</div>`;
        accs.forEach(a => { h += `<div class="item-list"><span>${a.n}</span><button class="buy-btn" onclick="currentAcc='${a.id}';sync()">${a.p} ðŸª™</button></div>`; });
        document.getElementById('shop').innerHTML = h;
    }

    function start() { state="PLAY"; score=0; obs=[]; ballX=300; document.getElementById('screen-hub').classList.remove('active-screen'); }

    function drawBall(x, y) {
        ctx.save();
        if(useLogo) {
            ctx.beginPath(); ctx.arc(x, y, 25, 0, Math.PI*2); ctx.clip();
            ctx.drawImage(logoImg, x-25, y-25, 50, 50);
        } else {
            ctx.fillStyle = ballColor; ctx.beginPath(); ctx.arc(x, y, 22, 0, Math.PI*2); ctx.fill();
        }
        ctx.restore();

        // Accessoires par dessus
        if(currentAcc === "acc_glasses") { ctx.fillStyle="#000"; ctx.fillRect(x-18, y-5, 36, 6); }
        if(currentAcc === "acc_crown") { ctx.fillStyle="#f1c40f"; ctx.beginPath(); ctx.moveTo(x-15,y-22); ctx.lineTo(x-15,y-32); ctx.lineTo(x,y-25); ctx.lineTo(x+15,y-32); ctx.lineTo(x+15,y-22); ctx.fill(); }
    }

    window.onkeydown=e=>{if(e.key.includes("Left"))keys["L"]=true;if(e.key.includes("Right"))keys["R"]=true;};
    window.onkeyup=e=>{if(e.key.includes("Left"))keys["L"]=false;if(e.key.includes("Right"))keys["R"]=false;};

    function loop() {
        ctx.fillStyle = "#000"; ctx.fillRect(0,0,600,1000);
        if(state === "PLAY") {
            if(keys["L"]) ballX-=10; if(keys["R"]) ballX+=10; ballX=Math.max(25,Math.min(575,ballX));
            if(Math.random()<0.05 && (obs.length===0 || obs[obs.length-1].y > 300)) obs.push({g:Math.random()*200+200, y:-50, p:false});
            obs.forEach(o => {
                o.y += 6; ctx.strokeStyle="#00f2ff"; ctx.lineWidth=35;
                ctx.beginPath(); ctx.moveTo(0,o.y); ctx.lineTo(o.g-90, o.y); ctx.stroke();
                ctx.beginPath(); ctx.moveTo(o.g+90, o.y); ctx.lineTo(600, o.y); ctx.stroke();
                if(o.y>ballY-20 && o.y<ballY+20 && (ballX<o.g-75 || ballX>o.g+75)) { state="HUB"; document.getElementById('screen-hub').classList.add('active-screen'); record=Math.max(record,score); sync(); }
                if(o.y > ballY && !o.p) { o.p=true; score++; }
            });
            drawBall(ballX, ballY);
            ctx.fillStyle="#fff"; ctx.font="900 80px Orbitron"; ctx.textAlign="center"; ctx.fillText(score,300,160);
        }
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
