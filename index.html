<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CYBER DASH - ULTIMATE</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; touch-action: none; -webkit-tap-highlight-color: transparent; }
        body { background: #000; color: #fff; font-family: 'Orbitron', sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* NAVIGATION MOBILE */
        #mobile-tabs { display: none; position: fixed; bottom: 0; left: 0; right: 0; height: 75px; background: rgba(5,5,15,0.95); border-top: 2px solid #00f2ff; z-index: 1000; justify-content: space-around; align-items: center; }
        .tab-btn { font-size: 10px; font-weight: 900; color: #fff; opacity: 0.4; text-align: center; }
        .tab-btn.active { opacity: 1; color: #00f2ff; text-shadow: 0 0 10px #00f2ff; }

        /* STRUCTURE */
        #left-col, #right-col { width: 320px; border: 1px solid #ffffff11; background: #05050f; margin: 10px; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; }
        #game-col { flex-grow: 1; display: flex; justify-content: center; align-items: center; position: relative; }
        #container { height: 94vh; aspect-ratio: 9/16; position: relative; border: 3px solid #fff; background: #000; overflow: hidden; border-radius: 15px; }
        canvas { width: 100%; height: 100%; display: block; }

        #white-flash { position: absolute; inset: 0; background: white; opacity: 0; z-index: 2000; pointer-events: none; transition: opacity 0.8s ease-in; }

        /* BOUTIQUE */
        .scroll-zone { flex-grow: 1; overflow-y: auto; padding: 15px; }
        .item-card { background: rgba(255,255,255,0.05); margin-bottom: 10px; padding: 12px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; border: 1px solid #ffffff11; }
        .buy-btn { background: #00f2ff; color: #000; border: none; padding: 8px 12px; border-radius: 8px; font-weight: 900; cursor: pointer; font-family: 'Orbitron'; font-size: 10px; }
        .buy-btn.equipped { background: #fff; box-shadow: 0 0 15px #fff; }

        /* BOUTONS MOBILE */
        .m-btn { display: none; position: absolute; bottom: 100px; width: 85px; height: 85px; background: rgba(255,255,255,0.05); border: 2px solid #fff; border-radius: 50%; z-index: 500; justify-content: center; align-items: center; font-weight: 900; transition: 0.1s; }
        .m-btn.active-press { background: #00f2ff; border-color: #00f2ff; box-shadow: 0 0 30px #00f2ff; color: #000; transform: scale(0.9); }
        #btn-L { left: 20px; } #btn-R { right: 20px; }

        @media (max-width: 1000px) {
            #mobile-tabs { display: flex; }
            #left-col, #right-col { display: none; position: absolute; inset: 0; width: 100%; height: calc(100% - 75px); margin: 0; z-index: 900; background: #000; border: none; }
            #game-col { width: 100%; height: calc(100% - 75px); }
            .active-view { display: flex !important; }
            #container { height: 100%; width: 100%; border: none; }
            .m-btn { display: flex; }
        }

        /* SCREENS */
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; background: rgba(0,0,0,0.95); z-index: 100; text-align: center; }
        .active-screen { display: flex !important; }
        .btn-ui { border: 2px solid #fff; padding: 15px 30px; color: #fff; cursor: pointer; font-weight: 900; margin-top: 20px; width: 80%; }
        .star { font-size: 50px; color: #ffd700; opacity: 0; transform: scale(0); transition: 0.5s; margin: 5px; }
        .star.pop { opacity: 1; transform: scale(1); }
    </style>
</head>
<body>

    <div id="mobile-tabs">
        <div class="tab-btn" onclick="openTab('left-col', this)">üèÜ<br>TOP</div>
        <div class="tab-btn active" onclick="openTab('game-col', this)">üéÆ<br>JEU</div>
        <div class="tab-btn" onclick="openTab('right-col', this)">üõí<br>SHOP</div>
    </div>

    <div id="left-col">
        <div style="padding:20px; color:#00f2ff; text-align:center; font-weight:900;">CLASSEMENT</div>
        <div id="leaderboard" class="scroll-zone"></div>
        <div style="background:#003087; padding:15px; text-align:center; cursor:pointer; font-weight:900;" onclick="window.open('https://paypal.me/frsaamya')">DON ‚ù§Ô∏è</div>
    </div>

    <div id="game-col" class="active-view">
        <div id="container">
            <div id="white-flash"></div>
            <div id="btn-L" class="m-btn">L</div><div id="btn-R" class="m-btn">R</div>
            
            <div id="screen-login" class="screen active-screen">
                <h1 style="color:#00f2ff; font-size:40px;">CYBER DASH</h1>
                <input type="text" id="nick" placeholder="PSEUDO..." maxlength="10" style="margin:20px; padding:15px; background:none; border:2px solid #fff; color:#fff; text-align:center; font-family:'Orbitron';">
                <div class="btn-ui" onclick="init()">ENTRER</div>
            </div>

            <div id="screen-hub" class="screen">
                <div id="hub-stats" style="color:#00f2ff; margin-bottom:15px; font-weight:900;"></div>
                <div id="lvls" style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px; margin-bottom:20px;"></div>
                <div class="btn-ui" style="background:#ff007f; border:none;" onclick="start('INF')">INFINI ‚ù§Ô∏è</div>
            </div>

            <div id="screen-win" class="screen">
                <h1 style="color:#ffd700;">R√âUSSI</h1>
                <div style="margin:20px;"><span class="star" id="s1">‚òÖ</span><span class="star" id="s2">‚òÖ</span><span class="star" id="s3">‚òÖ</span></div>
                <div class="btn-ui" onclick="closeWin()">CONTINUER</div>
            </div>

            <canvas id="cvs"></canvas>
        </div>
    </div>

    <div id="right-col">
        <div style="padding:20px; color:#00f2ff; text-align:center; font-weight:900;" ondblclick="if(prompt('CODE ADMIN?')==='2011'){coins+=5000;sync();}">BOUTIQUE</div>
        <div id="shop" class="scroll-zone"></div>
        <div id="user-coins" style="text-align:center; padding:15px; color:#ffd700; font-size:22px; font-weight:900;">0 ü™ô</div>
        <div style="background:#ffc439; color:#003087; padding:15px; text-align:center; font-weight:900; cursor:pointer;" onclick="window.open('https://paypal.me/frsaamya/2.99')">PACK 10.000 ü™ô (2.99‚Ç¨)</div>
    </div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyDoNMSFtT2i8Eqt_G3UwR92AxbtHhumDF0", authDomain: "cyberdash-2baf5.firebaseapp.com", databaseURL: "https://cyberdash-2baf5-default-rtdb.europe-west1.firebasedatabase.app", projectId: "cyberdash-2baf5", storageBucket: "cyberdash-2baf5.firebasestorage.app", messagingSenderId: "360233647601", appId: "1:360233647601:web:60aa25f439019ed7511850" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const cvs = document.getElementById("cvs"); const ctx = cvs.getContext("2d"); cvs.width = 600; cvs.height = 1000;
    
    let user="", ip="", coins=0, record=0, reached=1, ballX=300, ballY=750, ballVX=0, obs=[], pieces=[], particles=[], keys={}, state="LOGIN", score=0, currentLvl=1;
    let ballColor="#fff", currentTrail="none", owned=["#fff", "none"];

    function openTab(id, btn) { document.querySelectorAll('#left-col, #right-col, #game-col').forEach(el => el.classList.remove('active-view')); document.getElementById(id).classList.add('active-view'); document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
    function sync() { db.ref('users/'+ip).update({coins, record, reached, owned, ballColor, currentTrail, user}); }

    function init() {
        user = document.getElementById('nick').value.toUpperCase() || "PLAYER";
        document.getElementById('screen-login').classList.remove('active-screen'); document.getElementById('screen-hub').classList.add('active-screen');
        fetch('https://api.ipify.org?format=json').then(r=>r.json()).then(d=>{
            ip = d.ip.replace(/\./g, '_');
            db.ref('users/'+ip).on('value', s=>{
                const v = s.val()||{}; coins=v.coins||0; record=v.record||0; reached=v.reached||1; 
                owned=v.owned||["#fff", "none"]; ballColor=v.ballColor||"#fff"; currentTrail=v.currentTrail||"none";
                document.getElementById('user-coins').innerText = `${coins} ü™ô`; document.getElementById('hub-stats').innerText = `RECORD: ${record} | NIV: ${reached}`;
                renderShop(); renderLvls();
            });
        });
        db.ref('users').orderByChild('record').limitToLast(10).on('value', s=>{
            let h=""; let a=[]; s.forEach(x=>{a.push(x.val())}); a.reverse().forEach(p=>{ h+=`<div class="item-card"><span>${p.user||'ANON'}</span><b>${p.record||0}</b></div>`; });
            document.getElementById('leaderboard').innerHTML=h;
        });
    }

    const shopItems = [
        {id:"#fff", n:"BLANC", p:0, t:"skin"}, {id:"#00f2ff", n:"CYAN", p:200, t:"skin"}, {id:"BURGER", n:"BURGER üçî", p:1000, t:"skin"},
        {id:"SUN", n:"SOLEIL ‚òÄÔ∏è", p:1200, t:"skin"}, {id:"STAR", n:"ETOILE ‚≠ê", p:1500, t:"skin"},
        {id:"rainbow", n:"RAINBOW üåà", p:800, t:"trail"}, {id:"elec", n:"ELEC ‚ö°", p:1500, t:"trail"}
    ];

    function renderShop() {
        let h = ""; shopItems.forEach(item => {
            const isO = owned.includes(item.id); const isEq = (item.t==="skin")?ballColor===item.id : currentTrail===item.id;
            h += `<div class="item-card"><div><b>${item.n}</b><br><small>${isO?'D√âBLOQU√â':item.p+' ü™ô'}</small></div>
            <button class="buy-btn ${isEq?'equipped':''}" onclick="buy('${item.id}',${item.p},'${item.t}')">${isO?(isEq?'EQUIP√â':'CHOISIR'):'ACHETER'}</button></div>`;
        }); document.getElementById('shop').innerHTML = h;
    }

    function buy(id, p, type) { if(owned.includes(id)){ if(type==="skin") ballColor=id; else currentTrail=id; } else if(coins>=p){ coins-=p; owned.push(id); if(type==="skin") ballColor=id; else currentTrail=id; } sync(); renderShop(); }
    function renderLvls() { let h=""; for(let i=1; i<=9; i++) h+=`<div class="btn-ui" style="opacity:${i<=reached?1:0.2}; padding:12px; margin:0;" onclick="if(${i<=reached})start(${i})">${i}</div>`; document.getElementById('lvls').innerHTML=h; }
    function start(l) { currentLvl=l; state="PLAY"; score=0; obs=[]; pieces=[]; particles=[]; ballX=300; ballY=750; document.getElementById('screen-hub').classList.remove('active-screen'); document.getElementById('screen-win').classList.remove('active-screen'); ['s1','s2','s3'].forEach(s=>document.getElementById(s).classList.remove('pop')); }
    function closeWin() { document.getElementById('screen-win').classList.remove('active-screen'); document.getElementById('screen-hub').classList.add('active-screen'); }

    const press = (id, k, act) => { if(act){ keys[k]=true; document.getElementById(id).classList.add('active-press'); } else { keys[k]=false; document.getElementById(id).classList.remove('active-press'); } };
    document.getElementById('btn-L').ontouchstart=e=>{e.preventDefault(); press('btn-L','L',true)}; document.getElementById('btn-L').ontouchend=()=>press('btn-L','L',false);
    document.getElementById('btn-R').ontouchstart=e=>{e.preventDefault(); press('btn-R','R',true)}; document.getElementById('btn-R').ontouchend=()=>press('btn-R','R',false);
    window.onkeydown=e=>{if(e.key.includes("Left"))press('btn-L','L',true); if(e.key.includes("Right"))press('btn-R','R',true)}; window.onkeyup=e=>{press('btn-L','L',false);press('btn-R','R',false)};

    function loop() {
        ctx.fillStyle = "#000"; ctx.fillRect(0,0,600,1000);
        if(state === "PLAY" || state === "CINEMATIC") {
            if(currentTrail !== "none") {
                let pCol = currentTrail==="rainbow" ? `hsl(${Date.now()%360},100%,50%)` : "#00f2ff";
                particles.push({x: ballX+(Math.random()-0.5)*15, y: ballY+20, r: Math.random()*8+2, a: 1, c: pCol});
            }
            particles.forEach((p,i)=>{ p.y+=3; p.a-=0.025; if(p.a<=0) particles.splice(i,1); ctx.globalAlpha=p.a; ctx.fillStyle=p.c; ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); });
            ctx.globalAlpha = 1;

            if(state === "PLAY") { if(keys["L"]) ballVX-=1.8; else if(keys["R"]) ballVX+=1.8; ballVX*=0.85; ballX+=ballVX; ballX=Math.max(30,Math.min(570,ballX)); }
            else { ballY-=12; ballX+=(300-ballX)*0.1; ctx.fillStyle="white"; ctx.beginPath(); ctx.arc(300,-100,300,0,Math.PI*2); ctx.fill(); 
                if(ballY<50){ document.getElementById('white-flash').style.opacity="1"; setTimeout(()=>{ state="WIN"; document.getElementById('screen-win').classList.add('active-screen'); document.getElementById('white-flash').style.opacity="0"; ['s1','s2','s3'].forEach((s,i)=>setTimeout(()=>document.getElementById(s).classList.add('pop'),i*250)); },1000); } }

            const speed = (currentLvl === 'INF') ? 9 : 5 + (currentLvl*0.5);
            const gap = 195 - (currentLvl === 'INF' ? 45 : currentLvl*7);
            if(state === "PLAY" && Math.random()<0.04 && (obs.length===0 || obs[obs.length-1].y > 300)) { let c = Math.random()*(600-gap-100)+(gap/2+50); obs.push({g:c, y:-50, p:false}); if(Math.random()<0.3) pieces.push({x:c, y:-50}); }

            obs.forEach(o => {
                o.y += (state==="PLAY")?speed:speed*0.3; ctx.fillStyle = (currentLvl==='INF')?"#ff007f":"#00f2ff"; ctx.fillRect(0,o.y,o.g-gap/2,35); ctx.fillRect(o.g+gap/2,o.y,600,35);
                if(state==="PLAY" && o.y>ballY-25 && o.y<ballY+25 && (ballX<o.g-gap/2+15 || ballX>o.g+gap/2-15)) { state="HUB"; document.getElementById('screen-hub').classList.add('active-screen'); if(currentLvl==='INF'&&score>record) record=score; sync(); }
                if(state==="PLAY" && o.y>ballY && !o.p) { o.p=true; score++; if(currentLvl!=='INF'&&score>=20){ state="CINEMATIC"; if(currentLvl===reached)reached++; coins+=50; sync(); } }
            });
            pieces.forEach((p,i)=>{ if(state==="PLAY")p.y+=speed; ctx.fillText(currentLvl==='INF'?"‚ù§Ô∏è":"ü™ô",p.x-13,p.y+10); if(state==="PLAY"&&Math.hypot(p.x-ballX,p.y-ballY)<35){ pieces.splice(i,1); coins+=(currentLvl==='INF'?5:1); sync(); } });
            ctx.save(); ctx.translate(ballX, ballY); ctx.shadowBlur=20; ctx.shadowColor=ballColor.startsWith("#")?ballColor:"#fff";
            if(ballColor.startsWith("#")){ ctx.fillStyle=ballColor; ctx.beginPath(); ctx.arc(0,0,22,0,Math.PI*2); ctx.fill(); }
            else { ctx.font="42px Arial"; ctx.textAlign="center"; const em={BURGER:"üçî",SUN:"‚òÄÔ∏è",STAR:"‚≠ê"}; ctx.fillText(em[ballColor],0,15); }
            ctx.restore(); ctx.fillStyle="#fff"; ctx.font="900 85px Orbitron"; ctx.textAlign="center"; ctx.fillText(score, 300, 150);
        } requestAnimationFrame(loop);
    } loop();
</script>
</body>
</html>
