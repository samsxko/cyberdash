<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>CYBER DASH</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        * { box-sizing: border-box; touch-action: none; margin: 0; padding: 0; }
        body { background: #000; color: #fff; font-family: 'Orbitron', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }
        
        #app-container { 
            height: 90vh; /* On réduit un peu la taille pour être sûr que rien n'est coupé */
            aspect-ratio: 9/16; 
            position: relative; 
            border: 2px solid #00f2ff; 
            background: #000; 
            overflow: hidden; 
        }
        canvas { width: 100%; height: 100%; display: block; }

        .page { position: absolute; inset: 0; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px; z-index: 100; background: rgba(0,0,0,0.9); }
        .active { display: flex; }
        .btn { border: 2px solid #00f2ff; padding: 15px; cursor: pointer; text-transform: uppercase; font-weight: 900; background: rgba(0, 242, 255, 0.1); color: #00f2ff; width: 80%; margin: 10px 0; text-align: center; }
        
        /* Boutons L R très visibles */
        .mobile-ctrl { position: absolute; bottom: 20px; width: 70px; height: 70px; border: 3px solid #fff; border-radius: 50%; display: flex; justify-content: center; align-items: center; font-weight: 900; font-size: 24px; color: #fff; box-shadow: 0 0 15px #fff; z-index: 200; background: rgba(255,255,255,0.2); }
        #btn-L { left: 20px; }
        #btn-R { right: 20px; }
    </style>
</head>
<body>

    <div id="app-container">
        <div id="btn-L" class="mobile-ctrl">L</div>
        <div id="btn-R" class="mobile-ctrl">R</div>

        <div id="page-login" class="page active">
            <h1 style="color:#00f2ff; margin-bottom:20px;">CYBER DASH</h1>
            <input type="text" id="pseudoInput" placeholder="PSEUDO..." style="padding:10px; margin-bottom:10px; text-align:center;">
            <div class="btn" onclick="validateLogin()">START</div>
        </div>

        <div id="page-hub" class="page">
            <h2 id="welcome-msg" style="margin-bottom:20px;"></h2>
            <div class="btn" onclick="startMode('SAGA')">JOUER</div>
        </div>
        <canvas id="gameCanvas"></canvas>
    </div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDoNMSFtT2i8Eqt_G3UwR92AxbtHhumDF0",
        authDomain: "cyberdash-2baf5.firebaseapp.com",
        databaseURL: "https://cyberdash-2baf5-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "cyberdash-2baf5",
        storageBucket: "cyberdash-2baf5.firebasestorage.app",
        messagingSenderId: "360233647601",
        appId: "1:360233647601:web:60aa25f439019ed7511850"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = 600; canvas.height = 1000;

    let pseudo = "", state = "LOGIN", score = 0, ballX = 300, obstacles = [], keys = {}, lastObsY = 500;

    function validateLogin() {
        pseudo = document.getElementById('pseudoInput').value.toUpperCase();
        if(pseudo.length > 1) { 
            document.getElementById('welcome-msg').innerText = pseudo;
            document.getElementById('page-login').classList.remove('active');
            document.getElementById('page-hub').classList.add('active');
        }
    }

    function startMode() {
        state = "PLAY"; score = 0; obstacles = []; ballX = 300;
        document.getElementById('page-hub').classList.remove('active');
    }

    // Contrôles tactiles
    document.getElementById('btn-L').ontouchstart = (e) => { e.preventDefault(); keys["L"] = true; };
    document.getElementById('btn-L').ontouchend = () => { keys["L"] = false; };
    document.getElementById('btn-R').ontouchstart = (e) => { e.preventDefault(); keys["R"] = true; };
    document.getElementById('btn-R').ontouchend = () => { keys["R"] = false; };

    function gameLoop() {
        ctx.fillStyle = "#000"; ctx.fillRect(0,0,600,1000);

        if(state === "PLAY") {
            if(keys["L"]) ballX -= 12;
            if(keys["R"]) ballX += 12;
            ballX = Math.max(40, Math.min(560, ballX));

            if(Math.random() < 0.05 && lastObsY > 350) {
                obstacles.push({gap: Math.random()*300+150, y: -50});
                lastObsY = 0;
            }
            lastObsY += 8;

            obstacles.forEach((o, i) => {
                o.y += 8;
                ctx.fillStyle = "#00f2ff";
                ctx.fillRect(0, o.y, o.gap-110, 40);
                ctx.fillRect(o.gap+110, o.y, 600, 40);

                // COLLISION (Balle à 700px de haut maintenant !)
                if(o.y > 670 && o.y < 730 && (ballX < o.gap-95 || ballX > o.gap+95)) {
                    state = "LOGIN"; 
                    document.getElementById('page-hub').classList.add('active');
                }
                if(o.y > 710 && !o.passed) { o.passed = true; score++; }
            });
            obstacles = obstacles.filter(o => o.y < 1100);

            // DESSIN DE LA BALLE (BLANCHE ET LUMINEUSE)
            ctx.shadowBlur = 30; ctx.shadowColor = "#fff";
            ctx.fillStyle = "#fff";
            ctx.beginPath(); 
            ctx.arc(ballX, 700, 25, 0, Math.PI*2); // Position 700 = Bien visible
            ctx.fill();
            ctx.shadowBlur = 0;

            ctx.font = "900 80px Orbitron";
            ctx.textAlign = "center";
            ctx.fillText(score, 300, 150);
        }
        requestAnimationFrame(gameLoop);
    }
    gameLoop();
</script>
</body>
</html>
